@model IEnumerable<Cartorio11RI.ViewModels.ModeloDocxListViewModel>

@{
	ViewBag.Title = ViewContext.RouteData.Values["controller"];
	ViewBag.SubTitle = ViewContext.RouteData.Values["action"];
}


@section styles_especific {

	<style>
		/*------------------------------------------------------------------------------
		tbl-modelosdocx
		------------------------------------------------------------------------------*/
		#tbl-modelosdocx {
			/*border: 1px solid #808080; */
			table-layout: auto;
			width: 100%;
		}

			#tbl-modelosdocx tr td:nth-child(1) {
				width: 5%;
			}

			#tbl-modelosdocx tr td:nth-child(2) {
				width: 50%;
			}

			#tbl-modelosdocx tr td:nth-child(3) {
				width: 20%;
			}

			#tbl-modelosdocx tr td:nth-child(4) {
				text-align: right;
				align-content: flex-end;
				margin-left: 1em;
			}

		/**********************************************************************/
		.desaparecer {
			opacity: 0;
			transition: 0.5s;
		}
	</style>
}

<div id="divMensagem" class="alert" hidden>
	<label id="labelMensagem"></label>
</div>

<div id="content">
	<input hidden id="IP" />
	<div class="row">
		<div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
			<h1 class="page-title txt-color-blueDark">
				<i class="fa-fw fa fa-file-word-o"></i>
				@ViewBag.Title
				<span>
					<i class="fa fa-chevron-right"></i> @ViewBag.SubTitle
				</span>
			</h1>
		</div>
	</div>
	<section id="widget-grid" class="">
		<div class="row">
			<p>
				<a href="@Url.Action("NovoModelo", "Modelos")" class="btn btn-primary"><i class="glyphicon glyphicon-plus"></i> Novo Modelo</a>
			</p>

			<div class="jarviswidget jarviswidget-color-darken" id="wid-id-0" data-widget-togglebutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-collapsed="false">

				<!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"

				-->
				<header>
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>Arquivos</h2>
				</header>

				<!-- widget div-->
				<div>
					<!-- widget edit box -->
					<div class="jarviswidget-editbox">
						<!-- This area used as dropdown edit box -->
					</div>
					<!-- end widget edit box -->
					<!-- widget content -->
					<div class="widget-body no-padding">
						<table id="tbl-modelosdocx" class="table table-striped table-bordered table-hover">
							<thead>
								<tr>
									<th>
										Código
									</th>
									<th>
										Nome
									</th>
									<th>
										Tipo
									</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								@foreach (var item in Model)
								{
									<tr id="tr@item.Id">
										<td>
											@Html.DisplayFor(modelItem => item.Id)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.DescricaoModelo)
										</td>
										<td>
											@Html.DisplayFor(modelItem => item.DescricaoTipoAto)
										</td>
										<td>
											@Html.ActionLink("Editar", "EditarModelo", new { Id = item.Id }, new { @class = "btn btn-primary" })
											<button class="btn btn-danger desativar" onclick="removeLinha(this)">Desativar</button>
										</td>
									</tr>
								}
							</tbody>
						</table>
					</div>
					<!-- end widget content -->
				</div>
				<!-- end widget div -->
			</div>
		</div>
	</section>
</div>

@section pagespecific{

	<script type="text/javascript">

		$(document).ready(function () {

			//coloque aqui seu codigo jquery
			$('#tbl-modelosdocx').dataTable({
				columnDefs: [{ orderable: false, targets: [3] }],
				"language": {
					"sEmptyTable":   "Não foi encontrado nenhum registo",
					"sLoadingRecords": "A carregar...",
					"sProcessing":   "A processar...",
					"sLengthMenu":   "Mostrar _MENU_ registos",
					"sZeroRecords":  "Não foram encontrados resultados",
					"sInfo":         "Mostrando de _START_ até _END_ de _TOTAL_ registos",
					"sInfoEmpty":    "Mostrando de 0 até 0 de 0 registos",
					"sInfoFiltered": "(filtrado de _MAX_ registos no total)",
					"sInfoPostFix":  "",
					"sSearch":       "Procurar:",
					"sUrl":          "",
					"oPaginate": {
						"sFirst":    "Primeiro",
						"sPrevious": "Anterior",
						"sNext":     "Seguinte",
						"sLast":     "Último"
					},
					"oAria": {
						"sSortAscending":  ": Ordenar colunas de forma ascendente",
						"sSortDescending": ": Ordenar colunas de forma descendente"
					},
					decimal: ",",
					thousands: "."
				},
				"processing": true,
				//"serverSide": true,
				"filter": false,
				"autoWidth": true
			});

		});

	// funcao remove uma linha da tabela
	function removeLinha(linha) {
		var linha = linha.closest("tr");
		var i = linha.rowIndex;
		var ID = parseInt(linha.getAttribute("Id"));

		var IP = document.getElementById('IP').value;
		var token = $('input[name="__RequestVerificationToken"]').val();

		var dadosPost = {
			Ip: IP,
			Id: ID
		};

		var res = confirm("Deseja desativar o modelo de ID: " + ID);
		debugger;
		if (res) {
			$.ajax({
				url: '@Url.Action("DesativarModelo", "Modelos")',
				type: 'POST',
				data: {
					dadosPost,
					__RequestVerificationToken: token,
				},
				success: function (result) {
					//console.log(result);
					//console.log("Deu certo");
					//deleta a linha e da efeito
					linha.setAttribute("class", "desaparecer");
					setTimeout(function () {
						linha.remove();
						monstrarMensagem("Modelo removido com sucesso",true);
					}, 600);

				},
				error: function (error) {
					console.log(error);
					//console.log("Deu erro");
					monstrarMensagem("Erro ao remover",false);
				}
			});
		}
	}

	function monstrarMensagem(mensagem, statusMensagem) {

		if (statusMensagem == true)
		{
			$('#divMensagem').attr("class", "alert alert-success");
		} else {
			$('#divMensagem').attr("class", "alert alert-danger");
		}

		$('#labelMensagem').text(mensagem);
		$('#divMensagem').removeAttr("hidden");
	}

	</script>
}
