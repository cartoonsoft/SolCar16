@using Infra.Cross.Identity.Models
@using System.Security.Claims

@model IEnumerable<ApplicationUser>

@{
    ViewBag.Title = "Account";
    ViewBag.SubTitle = "Index";
}

@section styles_especific {
    <style>
        /*------------------------------------------------------------------------------
        tbl-usuarios
        ------------------------------------------------------------------------------*/
        #tbl-usuarios {
            /*border: 1px solid #808080; */
            table-layout: auto;
            width: 100%;
        }

            #tbl-usuarios tr td:nth-child(1) {
                width: 20%;
            }

            #tbl-usuarios tr td:nth-child(2) {
                width: 5%;
            }

            #tbl-usuarios tr td:nth-child(2) {
                width: 10%;
            }

            #tbl-usuarios tr td:nth-child(3) {
                width: 15%;
            }

            #tbl-usuarios tr td:nth-child(4) {
                width: 10%;
            }

            #tbl-usuarios tr td:nth-child(5) {
                width: 6%;
                align-content: flex-end;
                text-align: center;
                margin-left: 1em;
            }

            #tbl-usuarios tr td:nth-child(6) {
                width: 6%;
                align-content: flex-end;
                text-align: center;
                margin-left: 1em;
            }

            #tbl-usuarios tr td:nth-child(7) {
                width: 6%;
                align-content: flex-end;
                text-align: center;
                margin-left: 1em;
            }

            #tbl-usuarios tr td:nth-child(8) {
                width: 6%;
                align-content: flex-end;
                text-align: center;
                margin-left: 1em;
            }

            #tbl-usuarios tr td:nth-child(8) {
                text-align: left;
                margin-left: 1em;
            }
    </style>
}

<div id="content">
    <div class="row">
        <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
            <h1 class="page-title txt-color-blueDark">

                <!-- PAGE HEADER -->
                <i class="fa-fw fa fa-user"></i>
                @ViewBag.Title
                <span>
                    >
                    @ViewBag.SubTitle
                </span>
            </h1>
        </div>
    </div>
    <section id="widget-grid" class="">
        <div class="row">
            <p>
                <a href="@Url.Action("Register", "Account")" class="btn btn-primary"><i class="glyphicon glyphicon-plus"></i> Novo usuário</a>
            </p>

            <div class="jarviswidget jarviswidget-color-darken" id="wid-id-0" data-widget-togglebutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-collapsed="false">

                <!-- widget options:
                usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

                data-widget-colorbutton="false"
                data-widget-editbutton="false"
                data-widget-togglebutton="false"
                data-widget-deletebutton="false"
                data-widget-fullscreenbutton="false"
                data-widget-custombutton="false"
                data-widget-collapsed="true"
                data-widget-sortable="false"

                -->
                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>Usuários</h2>
                </header>

                <!-- widget div-->
                <div>
                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                    </div>
                    <!-- end widget edit box -->
                    <!-- widget content -->
                    <div class="widget-body no-padding">
                        <table id="tbl-usuarios" class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>
                                        Nome Completo
                                    </th>
                                    <th>
                                        Usuário
                                    </th>
                                    <th>
                                        Grupo
                                    </th>
                                    <th>
                                        E-mail
                                    </th>
                                    <th>
                                        Telefone
                                    </th>
                                    <th>
                                        Usuário<br />
                                        Ativo
                                    </th>
                                    <th>
                                        E-mail<br />
                                        conf.
                                    </th>
                                    <th>
                                        Tel<br />
                                        conf.
                                    </th>
                                    <th>
                                        Login<br />
                                        2-fatores
                                    </th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>
                                            <i class="fa fa-user" aria-hidden="true"></i>
                                            @Html.DisplayFor(modelItem => item.Nome)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.UserName)
                                        </td>
                                        <td>
                                            @if (item.Claims.Where(c => (c.ClaimType == ClaimTypes.Role) && (c.ClaimValue == "Admin")).FirstOrDefault() != null)
                                            {
                                                <label>Admin</label>
                                            }
                                            else if (item.Claims.Where(c => (c.ClaimType == ClaimTypes.Role) && (c.ClaimValue == "GerenteRI")).FirstOrDefault() != null)
                                            {
                                                <labe>Gerente RI</labe>
                                            }
                                            else if (item.Claims.Where(c => (c.ClaimType == ClaimTypes.Role) && (c.ClaimValue == "UsuarioRI")).FirstOrDefault() != null)
                                            {
                                                <label>Usuário RI</label>
                                            }
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Email)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.PhoneNumber)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Ativo)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.EmailConfirmed)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.PhoneNumberConfirmed)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.TwoFactorEnabled)
                                        </td>
                                        <td>
                                            <a href="@Url.Action("Edit", "Account", new { id = item.Id })" class="btn btn-primary btn-sm" title="Editar usuário">
                                                <i class="fa fa-edit" aria-hidden="true"></i>
                                            </a>
                                            @{ 
                                                if (item.Ativo)
                                                {
                                                    <a href="javascript:void(0);" class="btn btn-danger btn-sm" title="Desativar usuário" onclick="AtivarDesativarUsuario(this, '@item.Id', 'D');">
                                                        <i class="fa fa-close" aria-hidden="true"></i>
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="javascript:void(0);" class="btn btn-success btn-sm" title="Ativar usuário" onclick="AtivarDesativarUsuario(this, '@item.Id', 'A');">
                                                        <i class="fa fa-check" aria-hidden="true"></i>
                                                    </a>
                                                }
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                    </div>
                    <!-- end widget content -->
                </div>
                <!-- end widget div -->
            </div>
        </div>
    </section>
</div>

@section pagespecific {

    <script type="text/javascript">

        function AtivarDesativarUsuario(objLink, Id, Cmd) {

            var obj = objLink;

            var objData = {
                id: Id,
                cmd: Cmd 
            };

            $.ajax('@Url.Action("AtivaDesativaUsuario", "Usuarios")', {
                method: 'POST',
                dataType: 'json',
                data: objData,
                beforeSend: function () {
                    ShowProgreessBar("Processando requisição...");
                }
            }).done(function (data) {
                //
                if (data.success) {
                    //$("#txtResposta").val(data.resposta);
                    $.smallBox({
                        title: "Requisição realizada com sucesso!",
                        content: "<i class='fa fa-clock-o'></i> <i></i>",
                        color: "#296191",
                        iconSmall: "fa fa-thumbs-up bounce animated",
                        timeout: 4000
                    });

                    $(obj).switchClass("btn-danger", "btn-success");

                }
            }).fail(function (jq, textStatus, error) {
                //

            }).always(function () {
                HideProgressBar();
            });

        }

        var responsiveHelper_dt_basic = undefined;

        $(document).ready(function () {

            //coloque aqui seu codigo jquery
            $('#tbl-usuarios').dataTable({
                columnDefs: [{ orderable: false, targets: [3,4,5,6,7] }],
                "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-12 hidden-xs'l>r>" +
                    "t" +
                    "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
                "autoWidth": true,
                "preDrawCallback": function () {
                    // Initialize the responsive datatables helper once.
                    if (!responsiveHelper_dt_basic) {
                        responsiveHelper_dt_basic = new ResponsiveDatatablesHelper($('#tbl-usuarios'));
                    }
                },
                "rowCallback": function (nRow) {
                    responsiveHelper_dt_basic.createExpandIcon(nRow);
                },
                "drawCallback": function (oSettings) {
                    responsiveHelper_dt_basic.respond();
                },
                "language": {
                    "lengthMenu": "Mostrar _MENU_ reg. por página",
                    "zeroRecords": "Nenhum Registro Encontrado",
                    "info": "Mostrando Página _PAGE_ de _PAGES_",
                    "infoEmpty": "Nenhum registro Disponível",
                    "infoFiltered": "(filtrado)",
                    "loadingRecords": "Lendo...",
                    "processing": "Processando...",
                    "search": "Procurar: ",
                    "paginate": {
                        "first": "Primeiro",
                        "last": "Último",
                        "next": "Próx.",
                        "previous": "Anterior"
                    },
                }
            });



        });

    </script>
}
