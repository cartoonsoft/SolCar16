@model AdmCartorio.ViewModels.AtoListViewModel

@{
    ViewBag.Title = "Atos";
    ViewBag.SubTitle = "Bloquear";
}
@section styles_especific {
    <style>
        .linkArquivo:hover {
            cursor: pointer
        }
    </style>
}

<div id="content">
    <div class="row">
        <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
            <h1 class="page-title txt-color-blueDark">
                <i class="fa fa-pencil-square-o fa-fw "></i>
                @ViewBag.Title
                <span>
                    >
                    @ViewBag.SubTitle
                </span>
            </h1>
        </div>
    </div>
    <section id="widget-grid" class="">
        <div class="row">
            <article class="col-sm-12 col-md-12 col-lg-8">
                <div class="jarviswidget" id="wid-id-0" data-widget-colorbutton="false" data-widget-togglebutton="false" data-widget-editbutton="false" data-widget-deletebutton="false" data-widget-collapsed="false">
                    <header>
                        <h2>Bloquear o ato</h2>
                    </header>
                    <div>
                        <div class="jarviswidget-editbox">
                            <!-- This area used as dropdown edit box -->

                        </div>
                        <div class="widget-body">
                            <div class="row text-align-center">
                                <label style="color:black; font-size:24px;">
                                    Deseja Bloquear o Ato:
                                    <b>@Html.DisplayFor(model => model.Id)</b> ?
                                </label>
                            </div>
                            <br />
                            <fieldset>
                                <div class="row">
                                    <div class="col-sm-5">
                                        <section class="col col-6">
                                            <div class="row padding-10 padding-left-10 text-capitalize font-md">
                                                @Html.LabelFor(model => model.IdPrenotacao)
                                                <b>@Html.DisplayTextFor(model => model.IdPrenotacao)</b>
                                            </div>
                                            <div class="row padding-10 padding-left-10 text-capitalize font-md">
                                                @Html.LabelFor(model => model.NumMatricula)
                                                <b>@Html.DisplayTextFor(model => model.NumMatricula)</b>
                                            </div>
                                            <div class="row padding-10 padding-left-10 text-capitalize font-md">

                                                @Html.Label("Situação:")

                                                @if (!Model.Bloqueado)
                                                {
                                                    @Html.Label("Disponível para alteração")
                                                }
                                                else
                                                {
                                                    @Html.Label("Finalizado")
                                                }
                                            </div>
                                        </section>
                                    </div>
                                    <div class="col-sm-7">
                                        <section class="col col-5 bordered padding-top-15 padding-bottom-10 text-align-center">
                                            <br />
                                            @if (!Model.Bloqueado)
                                            {
                                                <h2>
                                                    <a id="btnDownload" target="_blank" class="linkArquivo" href="@Url.Action("DownloadFile","Ato",new { ID = Model.NumMatricula})">
                                                        Cliqui aqui para baixar o ato <i class="glyphicon glyphicon-download"></i>
                                                        <br />
                                                        <span class="text-danger font-xs">Após bloquear, não sera possível mais baixar o ato específico,<br /> somente o histórico</span>
                                                    </a>
                                                </h2>
                                            }
                                            else
                                            {
                                                <h2> Ato já finalizado  </h2>
                                            }
                                            <br />
                                        </section>
                                    </div>
                                </div>
                            </fieldset>
                            <br />  
                            <div class="">
                                @if (!Model.Bloqueado)
                                {
                                    <button type="button" typeof="button" id="btnBloquear" class="btn btn-success font-md margin-bottom-10" style="float:right;">
                                        Bloquear
                                    </button>
                                    @Html.ActionLink("Editar", "Editar", new { Id = Model.Id }, new { @class = "btn btn-primary font-md margin-bottom-10 margin-right-15", @style = "float:right;" })

                                }
                                else
                                {
                                    <label type="" id="" class="btn btn-success font-md margin-bottom-10" style="float:right;" disabled>
                                        Já Bloqueado
                                    </label>
                                }

                            </div>

                        </div>
                    </div>

                </div>
            </article>
        </div>
    </section>
</div>
<div class="modal fade" id="ModalLoading" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">

    @{
        Html.RenderPartial("ViewLoading");
    }

</div>
@Scripts.Render("~/Scripts/libs/jquery-2.1.1.min.js")

@section pagespecific{
    <script>

        $('#btnBloquear').on('click', function () {
            $('#ModalLoading').modal('show');
            $('#imgLoading').attr('src', '/Content/img/gifLoading.gif');
            $('#mensagemLoading').text('Finalizando Ato...');
            var form = $('#__AjaxAntiForgeryForm');
            var token = $('input[name="__RequestVerificationToken"]', form).val();
            $.ajax({
                url: '@Url.Action("BloquearAto","Ato")',
                method: 'POST',
                data: { NumMatricula: @(Model.NumMatricula),IdAto:@(Model.Id) , __RequestVerificationToken: token},
                success: function () {
                    $('#imgLoading').attr('src', '/Content/img/gifSuccess.gif');
                    $('#mensagemLoading').text('Finalizado com sucesso!');
                    //Redireciona para o index caso tenha dado certo
                    setTimeout(() => {
                        $('#ModalLoading').modal('hide');
                        window.location = '/ato';
                    }, 1700);
                },
                error: function () {
                    $('#imgLoading').attr('src', '/Content/img/errorImg.png');
                    $('#mensagemLoading').text('ERRO, ao Bloquear!');
                    setTimeout(() => {
                        $('#ModalLoading').modal('hide');
                    }, 1500);
                }
            });
        });
    </script>
}
